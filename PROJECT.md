# Техническое Задание: Веб-приложение для управления данными и рассылками (MVP)

## 1. Введение
### 1.1. Название проекта
Веб-приложение для управления клиентскими данными, их очистки и формирования целевых списков для рассылок.

### 1.2. Цель проекта
Основная долгосрочная цель: Повышение LTV (Lifetime Value) клиентов компании.
Цель MVP: Создать систему для эффективного сбора, очистки данных о продажах и формирования сегментированных списков для целевых рассылок на основе предоставленной бизнес-логики.

### 1.3. Целевая аудитория MVP (пользователи системы)
- Администратор системы: Ответственный за управление пользователями системы и базовые настройки.
- Аналитик: Ответственный за ввод и актуализацию данных о компаниях-клиентах, а также за настройку сопоставления полей для импорта данных.
- Модератор: Ответственный за загрузку данных о продажах (используя настроенное сопоставление), их очистку и настройку параметров для формирования списков рассылок.

## 2. Общие требования
### 2.1. Технологический стек
- Фронтенд: React
- Бэкенд: Node.js
- База данных: PostgreSQL

### 2.2. Интеграции
- Импорт данных из файлов формата XLSX и Google Sheets.
- Другие внешние интеграции в MVP не предусмотрены.

## 3. Пользовательские роли и права доступа в MVP
### 3.1. Администратор
- Создание, редактирование, удаление учетных записей пользователей системы (Аналитиков, Модераторов).
- Назначение ролей пользователям системы.
- (Возможно) Доступ к логам системы (обсуждается дополнительно).

### 3.2. Аналитик
- Добавление и редактирование информации о компаниях-клиентах (название, реквизиты, контактная информация и другие необходимые атрибуты).
- Добавление и редактирование информации о представителях компаний-клиентов (создание учетных записей для будущего использования в V2, без предоставления доступа в MVP).
- Настройка и управление сопоставлением полей из файлов/таблиц клиентов со стандартной структурой системной таблицы "Заказы".

### 3.3. Модератор
- Загрузка еженедельных файлов с данными о продажах (XLSX, Google Sheets), используя настроенные Аналитиком сопоставления полей.
- Доступ к интерфейсу очистки и стандартизации данных.
- Управление словарями корректных значений и алиасов.
- Настройка параметров для формирования списков рассылок.
- Скачивание сформированных списков рассылок.

## 4. Функциональные требования MVP
### 4.1. Модуль "Администрирование"
#### 4.1.1. Управление пользователями системы:
- Интерфейс для создания новых пользователей (логин, пароль, ФИО, роль).
- Возможность редактирования данных пользователя и его роли.
- Возможность деактивации/удаления пользователя.
- Список всех пользователей системы с возможностью фильтрации и поиска.

### 4.2. Модуль "Управление клиентами" (для роли Аналитика)
#### 4.2.1. Управление компаниями-клиентами:
- Интерфейс для добавления новой компании-клиента с полями: Название, ИНН, КПП, юридический адрес, фактический адрес, банковские реквизиты, контактные лица и их телефоны/email, и другие согласованные поля.
- Список всех компаний-клиентов с возможностью поиска, фильтрации и редактирования.

#### 4.2.2. Управление представителями компаний-клиентов:
- Интерфейс для добавления представителя компании-клиента (ФИО, должность, email, телефон) с привязкой к конкретной компании-клиенту. Эти учетные данные создаются для будущего использования и не предоставляют доступ в MVP.

#### 4.2.3. Настройка сопоставления полей для импорта данных клиента:
- Интерфейс для Аналитика, позволяющий для каждой компании-клиента настроить сопоставление (маппинг) полей из структуры файла/таблицы данных клиента со стандартными полями системной таблицы "Заказы".
- Возможность указать, какое поле из файла клиента соответствует каждому полю целевой системной таблицы "Заказы" (например, "ClientOrderDate" из файла клиента -> "order_date" в системе, "ItemSKU" -> "article_number").
- Система должна сохранять эти настройки сопоставления для каждого клиента.
- Примечание: Целевая структура системной таблицы "Заказы" предоставлена Заказчиком (см. Приложение 1 или отдельный документ с описанием схемы).

### 4.3. Модуль "Обработка и очистка данных" (для роли Модератора)
#### 4.3.1. Импорт данных о продажах:
- Интерфейс для загрузки файлов XLSX или указания ссылки на Google Sheets.
- При импорте данных система должна использовать предварительно настроенное Аналитиком сопоставление полей (см. пункт 4.2.3) для корректного разбора файла клиента.
- Предварительный просмотр структуры файла и отображение примененного сопоставления полей. В случае отсутствия или неполноты сопоставления для данного клиента, система должна информировать Модератора о необходимости его настройки Аналитиком и не позволять импорт до выполнения настройки.
- Валидация базовых форматов данных при загрузке (согласно типам данных в целевой таблице после сопоставления).
- История загрузок с указанием статуса (успешно, ошибка, в обработке), клиента, имени файла.

#### 4.3.2. Очистка и стандартизация данных:
- Система должна автоматически применять существующие словари корректных значений и алиасы (синонимы/замены) для исправления данных (например, имен, отчеств, названий городов, категорий товаров, названий товаров) в тех полях, которые подлежат такой обработке.
- Интерфейс для Модератора, где отображаются данные, которые не удалось автоматически распознать или исправить.
- Для каждого такого "проблемного" значения Модератор должен иметь возможность:
  - Отнести его к существующему корректному значению из словаря.
  - Создать новое корректное значение и добавить его в словарь.
  - Создать алиас (правило замены) для этого значения, чтобы в будущем оно исправлялось автоматически.
  - Пометить значение как "невозможно распознать" (с возможностью последующего анализа таких случаев).
- AI-ассистент: Система должна предлагать Модератору варианты исправления на основе предоставленной Заказчиком логики/алгоритма (например, для опечаток типа "Алесандра" -> "Александра"). Модератор подтверждает или отклоняет предложение AI.

#### 4.3.3. Управление словарями и алиасами:
- Интерфейс для просмотра и редактирования словарей корректных значений (например, справочник городов, имен, категорий товаров).
- Интерфейс для просмотра и редактирования алиасов (правил автозамены).

### 4.4. Модуль "Формирование списков для рассылок"
#### 4.4.1. Настройка параметров рассылки (Модератор):
- Интерфейс, где Модератор указывает:
  - Бюджет/максимальное количество сообщений для генерации.
  - Ограничения по времени и дням недели для предполагаемой рассылки.
  - Управление блок-листами: возможность загрузки/ввода списка клиентов (например, по ID или email), которым не следует отправлять сообщения. Система должна учитывать этот список при генерации.

#### 4.4.2. Генерация списков (Система):
- Система исполняет предоставленный Заказчиком детализированный поток SQL-запросов. Эти запросы должны определять:
  - Целевую аудиторию для рассылки (каким людям).
  - Время отправки (когда, в рамках заданных Модератором ограничений).
  - Содержание или тип предложения для рассылки (что отправлять).
- Логика сегментации и выбора предложений полностью определяется предоставленными SQL-запросами.

#### 4.4.3. Выгрузка списков:
- Сформированные списки должны быть доступны для скачивания Модератором в форматах CSV и XLSX.
- Таблица должна содержать все необходимые поля для осуществления рассылки (например, ID клиента, email/телефон, текст сообщения или идентификатор предложения).

## 5. Требования к данным
### 5.1. Входные данные
- Данные о продажах (структура будет согласована, но должна включать как минимум: идентификатор клиента, дата продажи, товар/услуга, количество, сумма).
- Данные о компаниях-клиентах.
- Настройки сопоставления полей для каждого клиента.
- Словари и алиасы.
- Блок-листы.

### 5.2. Хранение данных
- Все данные должны храниться в базе данных PostgreSQL.
- Необходимо обеспечить целостность и консистентность данных.

### 5.3. Выходные данные
- Списки для рассылок в форматах CSV, XLSX.

## 6. Ключевые зависимости от Заказчика
- Для успешной реализации MVP проекта Заказчик обязуется предоставить:
  - Детализированную логику/алгоритм (или SQL-запросы) для работы AI-ассистента по очистке данных (пункт 4.3.2).
  - Детализированный поток SQL-запросов для основного алгоритма генерации списков рассылок (пункт 4.4.2), определяющий критерии сегментации, выбор предложений и времени отправки.
  - Структуру целевой системной таблицы "Заказы" (предоставлена JSON-схема) и примеры файлов с данными о продажах от клиентов, демонстрирующие возможные различия в структурах.
  - Первоначальные словари корректных значений (если имеются).

## 7. Функционал, отложенный на будущие версии (V2+)
- Разработка системы углубленной аналитики данных.
- Создание дашбордов для представителей компаний-клиентов с визуализацией их данных и предоставление им доступа к системе.
- Интеграция с внешними сервисами рассылок.
- Расширенные возможности AI для анализа данных и предсказаний.

## 7. Требования к развертыванию

### 7.1. Параметры размещения
- Площадка: облако
- Географическое размещение: Санкт-Петербург
- Операционная система: Ubuntu 24.04 LTS
- Характеристики сервера: 4 vCPU, 8 ГБ RAM, 80 ГБ диск (тариф High C4-M8-D80)

### 7.2. Docker
- Для развертывания backend будет использоваться Docker (Dockerfile для Node.js).
- Для локального и облачного развертывания будет использоваться docker-compose (Node.js backend + PostgreSQL).
- Все переменные окружения и секреты будут храниться в .env файле (не коммитится в репозиторий).

---

### Приложение 1: Структура целевой таблицы "Заказы"

Будет основана на предоставленной JSON-схеме:

```
[
  { "name": "city", "type": "STRING" },
  { "name": "subdivision", "type": "STRING" },
  { "name": "pick_up_point", "type": "STRING" },
  { "name": "order_number", "type": "STRING" },
  { "name": "order_date", "type": "DATETIME" },
  { "name": "delivery_date", "type": "DATETIME" },
  { "name": "customer_id", "type": "STRING" },
  { "name": "telephone", "type": "STRING" },
  { "name": "name", "type": "STRING" },
  { "name": "last_name", "type": "STRING" },
  { "name": "car_brand", "type": "STRING" },
  { "name": "car_model", "type": "STRING" },
  { "name": "category", "type": "STRING" },
  { "name": "brand", "type": "STRING" },
  { "name": "article_number", "type": "STRING" },
  { "name": "product", "type": "STRING" },
  { "name": "quantity", "type": "INTEGER" },
  { "name": "revenue", "type": "FLOAT" },
  { "name": "cost_price", "type": "FLOAT" },
  { "name": "entry_date", "type": "DATETIME" },
  { "name": "entry_user", "type": "STRING" },
  { "name": "session_id", "type": "STRING" }
]
```

(Примечание: Атрибуты "mode", "description", "fields" из исходной JSON-схемы опущены для краткости в приложении, но должны учитываться при проектировании БД). 

## 8. UI/UX и библиотека компонентов

- Для фронтенда будет использоваться библиотека компонентов [Ant Design](https://ant.design/).
- Ant Design выбран за богатый набор готовых компонентов, строгий корпоративный стиль и отличную поддержку форм, таблиц, фильтров и админских интерфейсов.
- Все новые компоненты и интерфейсы должны реализовываться с использованием Ant Design. 